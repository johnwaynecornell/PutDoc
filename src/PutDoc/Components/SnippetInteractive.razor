@namespace PutDoc.Components
@inject IJSRuntime JS
@inject PutDoc.Services.PutDocState State
@using PutDoc.Services

<div @ref="_root">
    @((MarkupString)Html)
</div>

@code {
    [Parameter] public string Html { get; set; } = "";
    [Parameter] public Guid SnippetId { get; set; }

    private ElementReference _root;
    private DotNetObjectReference<SnippetInteractive>? _selfRef;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        _selfRef ??= DotNetObjectReference.Create(this);
        // ⚠️ re-run enhancer every render (idempotent via "already has toolbar" check)
        await JS.InvokeVoidAsync("putdocEnhance", _root, _selfRef);
    }

    // Components/SnippetInteractive.razor
    [JSInvokable]
    public async Task OnDomAction(string action, string puid)
    {
        await HtmlTransformService.ApplyAsync(State, SnippetId, action, puid);
    }


    public void Dispose() => _selfRef?.Dispose();
}